<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.0.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"></script>
    <script src="https://docs.opencv.org/3.4.0/opencv.js" type="text/javascript"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@1.0.0"> </script>

    <!--<script defer src="https://pyscript.net/latest/pyscript.js"></script>-->
    <!--<script type="module" src="vi.js"></script>-->
    <!--<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
      -->

    <link rel="stylesheet" type="text/css" href="style.css">

  </head>
  <body>
    <h1 style="text-align: center">Altify</h1>
    <div id="select" style="align-items:center">
        <h2>Altify is your go-to solution for making the web more inclusive and accessible to all. We're dedicated to ensuring that people with disabilities have equal access to online content. Our mission is to empower content creators, businesses, and web developers to provide meaningful alternative text (alt text) for images, making the internet a more inclusive space!</h2>
        <h3>Upload your image to get started</h2>
        <button onclick="selectType('image')">Upload Image</button>
      </div>
      <button onclick="selectType('home')" id="home" style="display: none">home</button>
      <div id ="imagepredict" style="display: none">
        <img id="myimage" height="180" width="180">
        <input type="file" id="photo" name="photo" accept="image/*" onchange="predictImage(event)">
        <p id="imagePrediction"></p>
        <p id="imagePrediction2"></p>
        <p id="imagePrediction3"></p>
      </div>
   
      </div>
      <script>
        const model =  tf.loadGraphModel('hourglass/model.json');
      CLASS_NAMES=[]
      const jsonFilePath = 'hourglass/imagenet_class_index.json';

fetch(jsonFilePath)
  .then((response) => {
    if (!response.ok) {
      throw new Error(`Failed to fetch JSON file: ${response.statusText}`);
    }
    return response.json();
  })
  .then((data) => {
    CLASS_NAMES=data;
  })
  .catch((error) => {
    console.error('Error:', error);
  });
      console.log(CLASS_NAMES[0])
      function selectType(el){
        if (el=="home"){
          document.getElementById("select").style.display="";
          document.getElementById("imagepredict").style.display="none";
          document.getElementById("home").style.display="none";
        }else{
          document.getElementById("select").style.display="none";
          document.getElementById("home").style.display="";
          if (el=="image"){
            document.getElementById("imagepredict").style.display="";
  
          }
        }
      }
      function predictImage(event){
        const image=document.getElementById("photo").files[0]
        image.src = URL.createObjectURL(event.target.files[0])
        var selectedFile = event.target.files[0];
        var reader = new FileReader();
  
        var imgtag = document.getElementById("myimage");
        imgtag.title = selectedFile.name;
        reader.onload = function(event) {
          imgtag.src = event.target.result;
        };
        
        reader.readAsDataURL(selectedFile);
        
        model.then(async function (res) {
          
      mobilenet.load().then(model => {
    // Classify the image.
    model.classify(imgtag).then(predictions => {
      console.log('Predictions: ');
      console.log(predictions);
      document.getElementById("imagePrediction").innerText="Most Likely("+Math.floor(predictions[0]["probability"]*100)+"%):"+predictions[0]["className"]
      document.getElementById("imagePrediction2").innerText="Alternate("+Math.floor(predictions[1]["probability"]*100)+"%):"+predictions[1]["className"]
      document.getElementById("imagePrediction3").innerText="Alternate("+Math.floor(predictions[2]["probability"]*100)+"%):"+predictions[2]["className"]
      window.speechSynthesis.speak(new SpeechSynthesisUtterance("This is most likely a "+predictions[0]["className"]));
      window.speechSynthesis.speak(new SpeechSynthesisUtterance("It also might be a"+predictions[1]["className"]+" or a "+predictions[2]["className"]));
    });
  });
  // Extract results as JavaScript objects
  
  }, function (err) {
      console.log(err);
  });
  
      }

      

        
  
      </script>
      
      <script type="css">
      </script>
      
    </body>
</html>